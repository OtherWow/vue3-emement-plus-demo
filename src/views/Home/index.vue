<template>
    <div class="common-layout">
        <el-container>
            <el-main>

                <el-card class="box-card" id="left_card" :style="{ height: cardHeight + 'px' }">
                    <template #header>
                        <el-row :gutter="20">
                            <el-col :span="3">
                                <p><el-text class="mx-1" tag="b">{{ ÈÄâ‰∏≠ÁöÑÂ∏ÅÁßç }}</el-text></p>
                            </el-col>
                            <el-col :span="5">
                                <p>24Â∞èÊó∂Êàê‰∫§ÈáèÔºö<el-text tag="b" type="danger">{{ ÈÄâ‰∏≠ÁöÑÂ∏ÅÁßç24Â∞èÊó∂Êàê‰∫§Èáè }}</el-text></p>
                            </el-col>
                            <el-col :span="6">
                                <p>24Â∞èÊó∂Êàê‰∫§È¢ùÔºö<el-text tag="b" type="danger">{{ ÈÄâ‰∏≠ÁöÑÂ∏ÅÁßç24Â∞èÊó∂‰∫§ÊòìÈ¢ù }}</el-text> <el-text class="mx-1"
                                        tag="b" type="primary">USDT</el-text>
                                </p>
                            </el-col>
                            <el-col :span="6">
                                <el-row :gutter="20">
                                    <el-col :span="20">
                                        <el-select v-model="ÂèåÈ©¨‰∏ÅÁ≠ñÁï•id" @change="ÂèåÈ©¨‰∏ÅÁ≠ñÁï•ÊîπÂèò" clearable placeholder="ÈÄâÊã©ÂèåÈ©¨‰∏ÅÁ≠ñÁï•"
                                            style="width:100%" filterable>
                                            <el-option v-for="item in ÂèåÈ©¨‰∏ÅÁ≠ñÁï•ÂàóË°®" :key="item.value" :label="item.label"
                                                :value="item.value">
                                                <span style="float: left">{{ item.label }}</span>
                                                <span style="
                                                    float: right;
                                                    color: var(--el-text-color-secondary);
                                                    font-size: 13px;
                                                    "><el-tag :type="item.is_run ? 'success' : 'danger'"
                                                        effect="dark">{{
                                                            item.is_run ? 'Â∑≤ÂêØÂä®' :
                                                            'ÂÅúÊ≠¢'
                                                        }}</el-tag></span>
                                            </el-option>
                                        </el-select>
                                    </el-col>
                                    <el-col :span="4">
                                        <el-button type="success" @click="È¶ñÈ°µÁõ¥Êé•ÂêØÂä®">ÂêØÂä®</el-button>
                                    </el-col>
                                </el-row>


                            </el-col>
                        </el-row>

                    </template>
                    <div id="main" style="width: 100%;" :style="{ height: ((cardHeight - 100) / 2 - 100) + 'px' }"></div>

                    <div id="main_kline" style="width: 100%;margin-top: 5px;"
                        :style="{ height: ((cardHeight - 100) / 2 + 100) + 'px' }">
                    </div>
                </el-card>
            </el-main>
            <el-aside width="450px" style="margin-top: 0px;padding: 20px;padding-left: 15px;">
                <el-card class="box-card" :style="{ height: cardHeight + 'px' }">
                    <el-tabs v-model="activeTab" class="demo-tabs" style="margin-top: 10px;">
                        <el-tab-pane label="ÊØèÂàÜÈíüÊåØÂπÖÊéíË°å" name="first">
                            <el-table :data="amplitude_1m_20_table_data" style="width: 100%" :height="cardHeight - 110">
                                <el-table-column prop="index" label="ÊéíÂêç" align="center" width="55"></el-table-column>
                                <el-table-column label="‰∫§ÊòìÂØπ" align="center" width="145">
                                    <template #default="scope">
                                        <el-button @click="Âà∑Êñ∞ÊåáÂÆöÂ∏ÅÁßçÁöÑÊåØÂπÖÊï∞ÊçÆ(scope.row.symbol)">{{
                                            scope.row.symbol }}</el-button>
                                    </template>

                                </el-table-column>
                                <el-table-column label="ÊåØÂπÖ" align="center">
                                    <template #default="scope">
                                        <el-tag type="success" effect="dark" size="large">{{ scope.row.amplitude
                                        }}%</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="‰∏äÊ¶úÊ¨°Êï∞" align="center">
                                    <template #default="scope">
                                        <el-tag type="success" effect="dark" size="large">{{ scope.row.count
                                        }}</el-tag>
                                    </template>
                                </el-table-column>

                            </el-table>




                        </el-tab-pane>
                        <el-tab-pane label="4Â∞èÊó∂ÂÜÖÊåØÂπÖ‰∏äÊ¶úÊï∞ÈáèÊéíË°å" name="second">
                            <el-table :data="amplitude_1m_top20_4h_count_table_data" style="width: 100%"
                                :height="cardHeight - 110">
                                <el-table-column prop="index" label="ÊéíÂêç" align="center" width="80"></el-table-column>
                                <el-table-column label="‰∫§ÊòìÂØπ" align="center">
                                    <template #default="scope">
                                        <el-button @click="Âà∑Êñ∞ÊåáÂÆöÂ∏ÅÁßçÁöÑÊåØÂπÖÊï∞ÊçÆ(scope.row.symbol)">{{
                                            scope.row.symbol }}</el-button>
                                    </template>

                                </el-table-column>
                                <el-table-column label="‰∏äÊ¶úÊ¨°Êï∞" align="center">
                                    <template #default="scope">
                                        <el-tag type="success" effect="dark" size="large">{{ scope.row.count
                                        }}</el-tag>
                                    </template>
                                </el-table-column>

                            </el-table>
                        </el-tab-pane>
                        <el-tab-pane label="ËµÑÈáëË¥πÁéáÊéíË°å" name="three">
                            <el-table :data="funding_rate_top20_now_table_data" style="width: 100%"
                                :height="cardHeight - 110">
                                <el-table-column prop="index" label="ÊéíÂêç" align="center" width="80"></el-table-column>
                                <el-table-column prop="symbol" label="‰∫§ÊòìÂØπ" align="center"></el-table-column>
                                <el-table-column label="ËµÑÈáëË¥πÁéá" align="center">
                                    <template #default="scope">
                                        <el-tag type="success" effect="dark" size="large">{{ scope.row.funding_rate
                                        }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="next_rate_time" label="ÂÄíËÆ°Êó∂" align="center"
                                    width="80"></el-table-column>
                            </el-table>
                        </el-tab-pane>
                    </el-tabs>

                </el-card></el-aside>
        </el-container>
    </div>
</template>

<script setup>
import { inject, onMounted, ref, onBeforeUnmount } from 'vue';
import {
    fapi_Ëé∑ÂèñÂΩìÂâçÂàÜÈíüÁöÑÊåØÂπÖÊéíË°å,
    fapi_Ëé∑ÂèñÊåáÂÆöÂ∏ÅÁßçÁöÑÊâÄÊúâÊåØÂπÖÊï∞ÊçÆ,
    fapi_Ëé∑Âèñ4Â∞èÊó∂ÂÜÖÂ∏ÅÁßç‰∏äÊ¶úÊ¨°Êï∞ÊéíË°å,
    fapi_Ëé∑ÂèñÊúÄÊñ∞ÁöÑËµÑÈáëË¥πÁéáÊéíË°åÂâç20,
    fapi_Ëé∑ÂèñÊåáÂÆöÂ∏ÅÁßçÁöÑ24Â∞èÊó∂Êï∞ÊçÆ,
    fapi_Ëé∑ÂèñÊåáÂÆöÂ∏ÅÁßçÁöÑkÁ∫øÊï∞ÊçÆ,
} from '@/api/binance_fapi'
import {
    api_È¶ñÈ°µÊü•ËØ¢Á≠ñÁï•ÂàóË°®,
    api_È¶ñÈ°µÁõ¥Êé•ÂêØÂä®,
} from '@/api/smading_strategy_api'

const ÈÄâ‰∏≠ÁöÑÂ∏ÅÁßç = ref('');
const ÈÄâ‰∏≠ÁöÑÂ∏ÅÁßç24Â∞èÊó∂Êàê‰∫§Èáè = ref(0);
const ÈÄâ‰∏≠ÁöÑÂ∏ÅÁßç24Â∞èÊó∂‰∫§ÊòìÈ¢ù = ref(0);
const amplitude_1m_20_table_data = ref([]);  // initial empty data
const amplitude_1m_top20_4h_count_table_data = ref([]);  // initial empty data
const funding_rate_top20_now_table_data = ref([]);  // initial empty data
const amplitude_1m_all_data = ref({});  // initial empty data
const intervalId = ref(null);
const cardHeight = ref(0);  // default height
const activeTab = ref('first');
// ÈÄöËøá inject ÊñπÊ≥ïËé∑Âèñ $echarts ÂØπË±°
const $echarts = inject('$echarts');
const updateHeight = () => {
    if (!document.getElementById('left_card')) return;
    cardHeight.value = window.innerHeight - 200;
    // console.log(window.innerHeight)
};

// ------------------------------------------------------------------------------------------------------------ÂèåÈ©¨‰∏ÅÁ≠ñÁï•ÂºÄÂßã----------------------------------------------------------------------------------------------------
const ÂèåÈ©¨‰∏ÅÁ≠ñÁï•ÂàóË°® = ref([]);
const ÂèåÈ©¨‰∏ÅÁ≠ñÁï•id = ref(null);
const Ëé∑ÂèñÂèåÈ©¨‰∏ÅÁ≠ñÁï•ÂàóË°® = async () => {
    const res = await api_È¶ñÈ°µÊü•ËØ¢Á≠ñÁï•ÂàóË°®(ÈÄâ‰∏≠ÁöÑÂ∏ÅÁßç.value);
    ÂèåÈ©¨‰∏ÅÁ≠ñÁï•ÂàóË°®.value = [];
    // console.log(res.data);
    res.data.data.forEach((item, index) => {
        ÂèåÈ©¨‰∏ÅÁ≠ñÁï•ÂàóË°®.value.push({
            value: item.id,
            label: item.exchange_name + "-" + item.strategy_note + "-" + item.position_side,
            is_run: item.is_run,
            exchange_id: item.exchange_id,
        });
    });
    return res.data;
};

const È¶ñÈ°µÁõ¥Êé•ÂêØÂä® = async () => {
    try {
        if (ÂèåÈ©¨‰∏ÅÁ≠ñÁï•id.value === null) {
            ElMessage({
                message: "ËØ∑ÈÄâÊã©ÂèåÈ©¨‰∏ÅÁ≠ñÁï•",
                type: "error"
            });
            return;
        }
        const exchange_id = ÂèåÈ©¨‰∏ÅÁ≠ñÁï•ÂàóË°®.value.find(item => item.value === ÂèåÈ©¨‰∏ÅÁ≠ñÁï•id.value).exchange_id;
        const res = await api_È¶ñÈ°µÁõ¥Êé•ÂêØÂä®(ÈÄâ‰∏≠ÁöÑÂ∏ÅÁßç.value, ÂèåÈ©¨‰∏ÅÁ≠ñÁï•id.value, exchange_id);
        // console.log("res", res);
        if (res.status === 200 && res.data.code === 200) {
            ElMessage({
                message: "È¶ñÈ°µÁõ¥Êé•ÂêØÂä®ÊàêÂäü",
                type: "success"
            });
            await Ëé∑ÂèñÂèåÈ©¨‰∏ÅÁ≠ñÁï•ÂàóË°®();
        } else {
            ElMessage({
                message: "È¶ñÈ°µÁõ¥Êé•ÂêØÂä®Â§±Ë¥•Ôºö" + res.data.msg,
                type: "error"
            });
        }
    } catch (error) {
        ElMessage({
            message: "È¶ñÈ°µÁõ¥Êé•ÂêØÂä®Â§±Ë¥•Ôºö" + error,
            type: "error"
        });
    }
};

const ÂèåÈ©¨‰∏ÅÁ≠ñÁï•ÊîπÂèò = (val) => {
    // console.log(val);
    ÂèåÈ©¨‰∏ÅÁ≠ñÁï•id.value = val;
};
// ------------------------------------------------------------------------------------------------------------ÂèåÈ©¨‰∏ÅÁ≠ñÁï•ÁªìÊùü----------------------------------------------------------------------------------------------------


// ------------------------------------------------------------------------------------------------------------Âà∑Êñ∞ÊéíË°åÊ¶úÂºÄÂßã----------------------------------------------------------------------------------------------------
const Âà∑Êñ∞ÊØèÂàÜÈíüÊåØÂπÖÊéíË°å = async () => {
    const res = await fapi_Ëé∑ÂèñÂΩìÂâçÂàÜÈíüÁöÑÊåØÂπÖÊéíË°å();
    // console.log(res.data);
    amplitude_1m_20_table_data.value = res.data;
    return res.data;
};

const Âà∑Êñ∞ÊúÄÊñ∞ÁöÑËµÑÈáëË¥πÁéáÊéíË°åÂâç20 = async () => {
    const res = await fapi_Ëé∑ÂèñÊúÄÊñ∞ÁöÑËµÑÈáëË¥πÁéáÊéíË°åÂâç20();
    // console.log(res.data);
    funding_rate_top20_now_table_data.value = res.data;
    return res.data;
};

const Âà∑Êñ∞4Â∞èÊó∂ÂÜÖÂ∏ÅÁßç‰∏äÊ¶úÊ¨°Êï∞ÊéíË°å = async () => {
    const res = await fapi_Ëé∑Âèñ4Â∞èÊó∂ÂÜÖÂ∏ÅÁßç‰∏äÊ¶úÊ¨°Êï∞ÊéíË°å();
    // console.log("Âà∑Êñ∞4Â∞èÊó∂ÂÜÖÂ∏ÅÁßç‰∏äÊ¶úÊ¨°Êï∞ÊéíË°å");
    // console.log(res.data);
    amplitude_1m_top20_4h_count_table_data.value = res.data;
    return res.data;
};

// ------------------------------------------------------------------------------------------------------------Âà∑Êñ∞ÊéíË°åÊ¶úÁªìÊùü----------------------------------------------------------------------------------------------------
// ------------------------------------------------------------------------------------------------------------ÂõæË°®Áõ∏ÂÖ≥ÂºÄÂßã----------------------------------------------------------------------------------------------------

const Âà∑Êñ∞ÊåáÂÆöÂ∏ÅÁßçÁöÑÊåØÂπÖÊï∞ÊçÆ = async (symbol) => {
    const promise_res = fapi_Ëé∑ÂèñÊåáÂÆöÂ∏ÅÁßçÁöÑÊâÄÊúâÊåØÂπÖÊï∞ÊçÆ(symbol);
    const promise_res_24 = fapi_Ëé∑ÂèñÊåáÂÆöÂ∏ÅÁßçÁöÑ24Â∞èÊó∂Êï∞ÊçÆ(symbol);
    const promise_res_k = fapi_Ëé∑ÂèñÊåáÂÆöÂ∏ÅÁßçÁöÑkÁ∫øÊï∞ÊçÆ(symbol);
    // console.log(res.data, res_24.data, res_k.data);
    const [res_24, res_k] = await Promise.all([promise_res_24, promise_res_k]);
    let Êàê‰∫§Èáè_24Â∞èÊó∂ = res_24.data.volume;
    let Êàê‰∫§È¢ù_24Â∞èÊó∂ = res_24.data.quoteVolume;

    Êàê‰∫§Èáè_24Â∞èÊó∂ = Êàê‰∫§Èáè_24Â∞èÊó∂.toString().replace(/\d+/, function (n) { // ÂÖàÊèêÂèñÊï¥Êï∞ÈÉ®ÂàÜ
        return n.replace(/(\d)(?=(\d{3})+$)/g, function ($1) {
            return $1 + ",";
        });
    });
    // Êàê‰∫§È¢ù_24Â∞èÊó∂ 3‰Ωç‰πãÈó¥Âä†ÈÄóÂè∑ Â∞èÊï∞ÁÇπÂêéÁöÑÂÜÖÂÆπÊà™Êñ≠‰∏çË¶Å
    Êàê‰∫§È¢ù_24Â∞èÊó∂ = Êàê‰∫§È¢ù_24Â∞èÊó∂.toString().replace(/\d+/, function (n) { // ÂÖàÊèêÂèñÊï¥Êï∞ÈÉ®ÂàÜ
        return n.replace(/(\d)(?=(\d{3})+$)/g, function ($1) {
            return $1 + ",";
        });
    }).split(".")[0];
    ÈÄâ‰∏≠ÁöÑÂ∏ÅÁßç.value = symbol;
    ÈÄâ‰∏≠ÁöÑÂ∏ÅÁßç24Â∞èÊó∂Êàê‰∫§Èáè.value = Êàê‰∫§Èáè_24Â∞èÊó∂;
    ÈÄâ‰∏≠ÁöÑÂ∏ÅÁßç24Â∞èÊó∂‰∫§ÊòìÈ¢ù.value = Êàê‰∫§È¢ù_24Â∞èÊó∂;
    await Ëé∑ÂèñÂèåÈ©¨‰∏ÅÁ≠ñÁï•ÂàóË°®();
    // 3. Ê†ºÂºèÂåñÊï∞ÊçÆ
    const formattedData = res_k.data.map(item => {
        const date = new Date(+item[0]);
        // console.log(item[0], date);
        const hours = date.getHours().toString().padStart(2, '0');
        const minutes = date.getMinutes().toString().padStart(2, '0');
        const timeStr = `${hours}:${minutes}`;
        return [
            +item[1], +item[4], +item[3], +item[2], // ÂºÄ„ÄÅÊî∂„ÄÅ‰Ωé„ÄÅÈ´ò
            (-(+item[1] - +item[4]) / +item[4] * 100).toFixed(2), // Ê∂®ÂπÖ
            ((+item[2] - +item[3]) / +item[3] * 100).toFixed(2), // ÊåØÂπÖ
            (+item[7]).toString().replace(/\d+/, function (n) { // ÂÖàÊèêÂèñÊï¥Êï∞ÈÉ®ÂàÜ
                return n.replace(/(\d)(?=(\d{3})+$)/g, function ($1) {
                    return $1 + ",";
                });
            }).split(".")[0],//‰∫§ÊòìÈáè
            timeStr,
        ]
    });

    //Ê†πÊçÆres_kÁîüÊàêÊàê‰∫§ÈáèÊü±Áä∂ÂõæÈúÄË¶ÅÁöÑÊï∞ÊçÆ
    const volumes = res_k.data.map(item => { return item[7] })
    console.log("volumes", volumes);

    // formattedTimeData ‰∏∫Êó∂ÂàÜÊ†ºÂºè
    const formattedTimeData = res_k.data.map(item => {
        // ÂÖàÊääitem[0]Â≠óÁ¨¶‰∏≤ËΩ¨ÊàêÊó∂Èó¥Êà≥
        const date = new Date(+item[0]);
        // console.log(item[0], date);
        const hours = date.getHours().toString().padStart(2, '0');
        const minutes = date.getMinutes().toString().padStart(2, '0');
        const timeStr = `${hours}:${minutes}`;
        // console.log(timeStr);
        return timeStr;  // Áî®Ê†ºÂºèÂåñÁöÑÊó∂Èó¥ÊõøÊç¢ÂéüÂßãÁöÑÊó∂Èó¥Êà≥ÔºåÂπ∂‰øùÁïôÂÖ∂‰ªñÊï∞ÊçÆ
    });

    var myChart_kline = $echarts.init(document.getElementById('main_kline'));
    // console.log(formattedData);
    myChart_kline.setOption({
        title: {
            text: ÈÄâ‰∏≠ÁöÑÂ∏ÅÁßç.value + ' 1m KÁ∫øÊï∞ÊçÆ-4h',
            left: 10
        },
        grid: [{
            // ËøôÊòØÁ¨¨‰∏Ä‰∏™gridÔºåÁî®‰∫éKÁ∫øÂõæ
            left: '10%',
            right: '10%',
            bottom: '30%',
            height: '60%', // ËÆæÁΩÆ‰∏∫80%ÁöÑÈ´òÂ∫¶
        }, {
            // ËøôÊòØÁ¨¨‰∫å‰∏™gridÔºåÁî®‰∫éÊü±Áä∂Âõæ
            left: '10%',
            right: '10%',
            top: '68%',  // ÂºÄÂßã‰∫éÊï¥‰ΩìÈ´òÂ∫¶ÁöÑ85%Ôºå‰∏éKÁ∫øÂõæÂ∫ïÈÉ®Êúâ5%ÁöÑÈó¥Èöî
            height: '22%', // ËÆæÁΩÆ‰∏∫15%ÁöÑÈ´òÂ∫¶Ôºå‰∏éKÁ∫øÂõæÂ∫ïÈÉ®Êúâ5%ÁöÑÈó¥ÈöîÔºåÂÖ±ËÆ°100%
        }],
        xAxis: [
            {
                type: 'category',
                data: formattedTimeData,
                boundaryGap: false,
                axisLine: { onZero: false },
                splitLine: { show: false },
                min: 'dataMin',
                max: 'dataMax',
                axisPointer: {
                    z: 100
                }
            },
            {
                type: 'category',
                gridIndex: 1,
                data: formattedTimeData,
                boundaryGap: false,
                axisLine: { onZero: false },
                axisTick: { show: false },
                splitLine: { show: false },
                axisLabel: { show: false },
                min: 'dataMin',
                max: 'dataMax'
            }
        ],
        yAxis: [{
            scale: true,
            splitArea: {
                show: true
            }
        }, {
            scale: true,
            gridIndex: 1,
            splitNumber: 2,
            axisLabel: { show: false },
            axisLine: { show: false },
            axisTick: { show: false },
            splitLine: { show: false }
        }],

        tooltip: {
            trigger: 'axis',
            transitionDuration: 0,
            confine: true,
            borderRadius: 4,
            borderWidth: 1,
            borderColor: '#333',
            backgroundColor: 'rgba(255,255,255,0.9)',
            textStyle: {
                fontSize: 12,
                color: '#333'
            },
            formatter: function (params) {
                // console.log(params[0].data);
                const kData = params.find(p => p.seriesType === 'candlestick').data;
                const [index, open, close, low, high, Ê∂®ÂπÖ, ÊåØÂπÖ, ‰∫§ÊòìÈ¢ù, ÂºÄÁõòÊó∂Èó¥] = kData;
                const isRise = close > open;  // Âà§Êñ≠ÊòØÂê¶Ê∂®‰∫Ü
                const point = isRise ? 'üü¢' : 'üî¥';  // ÈÄâÊã©Áõ∏Â∫îÁöÑÂ∞èÂúÜÁÇπ
                return `
                        ${point}<br>
                        ÂºÄÁõòÊó∂Èó¥: ${ÂºÄÁõòÊó∂Èó¥}<br>
                        ÂºÄÁõò: ${open} USDT<br>
                        Êî∂Áõò: ${close} USDT<br>
                        ÊúÄ‰Ωé: ${low} USDT<br>
                        ÊúÄÈ´ò: ${high} USDT<br>
                        Ê∂®ÂπÖÔºö${Ê∂®ÂπÖ}%<br>
                        ÊåØÂπÖÔºö${ÊåØÂπÖ}%<br>
                        ‰∫§ÊòìÈ¢ù: ${‰∫§ÊòìÈ¢ù} USDT<br>
                    `;
            }

        },
        toolbox: {
            feature: {
                dataZoom: {
                    yAxisIndex: false
                },
                brush: {
                    type: ['lineX', 'clear']
                }
            }
        },
        brush: {
            xAxisIndex: 'all',
            brushLink: 'all',
            outOfBrush: {
                colorAlpha: 0.1
            }
        },
        axisPointer: {
            link: [
                {
                    xAxisIndex: 'all'
                }
            ],
            label: {
                backgroundColor: '#777'
            }
        },
        series: [{
            type: 'candlestick',
            data: formattedData,
            itemStyle: {
                color: 'green',  // Ê∂®ÁöÑÈ¢úËâ≤
                color0: 'red',  // Ë∑åÁöÑÈ¢úËâ≤
                borderColor: 'green',  // Ê∂®ÁöÑËæπÊ°ÜÈ¢úËâ≤
                borderColor0: 'red'  // Ë∑åÁöÑËæπÊ°ÜÈ¢úËâ≤
            }

        },
        {
            name: 'Volume',
            type: 'bar',
            xAxisIndex: 1,
            yAxisIndex: 1,
            data: volumes,
            itemStyle: {
                color: function (params) {
                    // Â¶ÇÊûúÊî∂Áõò‰ª∑ÔºàÁ¥¢Âºï‰∏∫1ÔºâÂ§ß‰∫éÂºÄÁõò‰ª∑ÔºàÁ¥¢Âºï‰∏∫0ÔºâÔºåÂàô‰∏∫ÁªøËâ≤ÔºåÂê¶Âàô‰∏∫Á∫¢Ëâ≤
                    return formattedData[params.dataIndex][1] > formattedData[params.dataIndex][0] ? 'green' : 'red';
                }
            }
        }],
        dataZoom: [
            {
                type: 'inside',
                xAxisIndex: [0, 1] // ‰Ωø‰∏§‰∏™xËΩ¥ÈÉΩ‰∏éÊ≠§Êï∞ÊçÆÁº©ÊîæÁõ∏ÂÖ≥ËÅî
            },
            {
                type: 'slider',
                xAxisIndex: [0, 1] // ‰Ωø‰∏§‰∏™xËΩ¥ÈÉΩ‰∏éÊ≠§Êï∞ÊçÆÁº©ÊîæÁõ∏ÂÖ≥ËÅî
            }
        ]

    });
    // Âü∫‰∫éÂáÜÂ§áÂ•ΩÁöÑdomÔºåÂàùÂßãÂåñechartsÂÆû‰æã
    var myChart = $echarts.init(document.getElementById('main'));
    const res = await promise_res;
    amplitude_1m_all_data.value = res.data;
    myChart.setOption({
        title: {
            text: ÈÄâ‰∏≠ÁöÑÂ∏ÅÁßç.value + ' ‰∏ÄÂ§©ÂÜÖÊåØÂπÖÊï∞ÊçÆÁªüËÆ°',
            left: 10
        },
        toolbox: {
            feature: {
                dataZoom: {
                    yAxisIndex: false
                },
                saveAsImage: {
                    pixelRatio: 2
                }
            }
        },
        tooltip: {
            trigger: 'axis',
            axisPointer: {
                type: 'shadow'
            }
        },
        grid: {
            bottom: 90
        },
        xAxis: [
            {
                data: amplitude_1m_all_data.value.x_data,
                silent: false,
                splitLine: {
                    show: false
                },
                splitArea: {
                    show: false
                }
            }
        ],
        yAxis: {
            splitArea: {
                show: false
            }
        },
        series: [
            {
                name: 'ÊåØÂπÖ',
                type: 'bar',
                barWidth: '60%',
                data: amplitude_1m_all_data.value.y_data,
                large: true
            }
        ],
        dataZoom: [
            {
                type: 'inside',
                start: 83.6,
                end: 100
            },
            {
                type: 'slider',
                start: 83.6,
                end: 100
            }
        ]

    })

};

// ------------------------------------------------------------------------------------------------------------ÂõæË°®Áõ∏ÂÖ≥ÂºÄÂßã----------------------------------------------------------------------------------------------------
onMounted(async () => {
    updateHeight();
    const data = await Âà∑Êñ∞ÊØèÂàÜÈíüÊåØÂπÖÊéíË°å();
    Âà∑Êñ∞4Â∞èÊó∂ÂÜÖÂ∏ÅÁßç‰∏äÊ¶úÊ¨°Êï∞ÊéíË°å();
    if (data && data.length > 0) {
        // console.log(data[0].symbol);
        const symbol = data[0].symbol;
        await Âà∑Êñ∞ÊåáÂÆöÂ∏ÅÁßçÁöÑÊåØÂπÖÊï∞ÊçÆ(symbol);
    }
    Âà∑Êñ∞ÊúÄÊñ∞ÁöÑËµÑÈáëË¥πÁéáÊéíË°åÂâç20();
    window.addEventListener('resize', updateHeight);
    intervalId.value = setInterval(() => {
        const currentSeconds = new Date().getSeconds();
        if (currentSeconds === 22) {
            Âà∑Êñ∞ÊØèÂàÜÈíüÊåØÂπÖÊéíË°å();
            Âà∑Êñ∞4Â∞èÊó∂ÂÜÖÂ∏ÅÁßç‰∏äÊ¶úÊ¨°Êï∞ÊéíË°å();
            Âà∑Êñ∞ÊúÄÊñ∞ÁöÑËµÑÈáëË¥πÁéáÊéíË°åÂâç20();
        }
    }, 1000); // Run this every second
});

onBeforeUnmount(() => {
    window.removeEventListener('resize', updateHeight);
    clearInterval(intervalId.value);
});




</script>

<style lang="less" scoped></style>